var savedTime = 0;
$(document).ready(function () {
    _.templateSettings = {
            interpolate: /\{\{(.+?)\}\}/g
        };

  //moment.lang('de');

 // Check for the various File API support.
    if (window.File && window.FileReader && window.FileList && window.Blob) {
      // Great success! All the File APIs are supported.
    } else {
      alert('Die File APIs werden von deinem Browser nicht unterst√ºtzt. Bitte versuch es mit einem andern (z.B. aktuellen Firefox)');
    }
  //Check local Storage support.
  if(('localStorage' in window) && window['localStorage'] !== null){
    if(localStorage.getItem("savedTimeKey") != null){
      savedTime = Number(localStorage.getItem("savedTimeKey"));
      var bla = moment.duration(savedTime, 'minutes').humanize();
      console.log("Saved time until now " + bla, savedTime);
    }
    
    }

$("#afterTableCalulation").hide();
$("#fileChooser").change(function(event){
  handleFileSelect(event, function(fileConetent){
            var res = stringToJSONObject(fileConetent);
            printTables(res, $('#schedule'));
            $("#optionsArea").show(1000);
            
            if(('localStorage' in window) && window['localStorage'] !== null){
            savedTime += res.data.length;
            console.log("try to save", savedTime, res.data.length);
  
              localStorage.setItem("savedTimeKey",savedTime);
              console.log("Saved",localStorage.getItem("savedTimeKey")  )
            }
  });
});

$("#pageBreakAfterDay").change(function(event){
  var dates = $(".dateTd");
  $.each(dates, function(index, value){
    var date = $(value).html().substring(0,2);
    if(date == event.currentTarget.value){
      //console.log("date",date);
      $(value).parent().after('<tr class="breakPage innerTableBreak" ></tr>');
    }
  });
//  console.log("pageBreakAfterDay", event.currentTarget.value );

});

$("#deleteInnerPageBreaks").click(function(){
  //console.log("Remove",$('.innerTableBreak'));
  $('.innerTableBreak').remove();
})

$("#fontSize").change(function(event){
//console.log("fontSize", event.currentTarget.value);
$("tbody").css("font-size", event.currentTarget.value + "px");
});
$("#columHeight").change(function(event){
//console.log("columHeight", event.currentTarget.value);
$("td").css("height", event.currentTarget.value + "px");
});


});

function handleFileSelect(evt, callback) {
    var files = evt.target.files; // FileList object

    // Loop through the FileList.
    for (var i = 0, f; f = files[i]; i++) {
        //console.log("Type ", f.type);
      // Only process image files.
      if (!f.type.match('text/*')) {
        continue;
      }else{
          console.log("Type ", f.type);
      }

      var reader = new FileReader();

      // Closure to capture the file information.
      reader.onload = (function(theFile) {
        return function(e) {
            callback(e.target.result);
        };
      })(f);
      reader.readAsText(f, 'ISO-8859-1');
    }
  }




