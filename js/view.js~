define(['jquery'], function($) {

    var SchichtplannerFormatterView = function() {
        var constructor,
            that = {},
            my = {};

        constructor = function() {

    $("#fileChooser").change(function(event){
       my.handleFileSelect(event, function(fileConetent){
                //$("#schedule").spin("large", "white");
                var res = schichtplanFormatter.stringToJSONObject(fileConetent);
                schichtplanFormatter.printTables(res, $('#schedule'));
                
                //Check local Storage support.
                if(('localStorage' in window) && window['localStorage'] !== null){
                  var savedTime = Number(localStorage.getItem("savedTimeKey"));
                  savedTime += res.data.length;
                  localStorage.setItem("savedTimeKey",savedTime);
                  var humanTime = moment.duration(savedTime, 'minutes').humanize();
                  $('#usageInfo').html(humanTime + " deiner Lebenszeit wurde nicht mit copy and paste verschwendet.");
                }
                $("#optionsArea").show(1000);
      });
    });

    $("#pageBreakAfterDay").change(function(event){
      var dates = $(".dateTd");
      $.each(dates, function(index, value){
        var date = $(value).html().substring(0,2);
        if(date == event.currentTarget.value){
          //console.log("date",date);
          $(value).parent().after('<tr class="breakPage innerTableBreak" ></tr>');
        }
      });
    //  console.log("pageBreakAfterDay", event.currentTarget.value );

    });

    $("#deleteInnerPageBreaks").click(function(){
      //console.log("Remove",$('.innerTableBreak'));
      $('.innerTableBreak').remove();
    })

    $("#fontSize").change(function(event){
      //console.log("fontSize", event.currentTarget.value);
      $("tbody").css("font-size", event.currentTarget.value + "px");
    });
    
    $("#columHeight").change(function(event){
      //console.log("columHeight", event.currentTarget.value);
      $("td").css("height", event.currentTarget.value + "px");
    });
  
  }

  
  my.handleFileSelect = function (evt, callback) {
    var files = evt.target.files; // FileList object

    // Loop through the FileList.
    for (var i = 0, f; f = files[i]; i++) {
        //console.log("Type ", f.type);
      // Only process image files.
      if (!f.type.match('text/*')) {
        continue;
      }else{
          console.log("Type ", f.type);
      }

      var reader = new FileReader();

      // Closure to capture the file information.
      reader.onload = (function(theFile) {
        return function(e) {
            callback(e.target.result);
        };
      })(f);
      reader.readAsText(f, 'ISO-8859-1');
    }
  }
  
          return constructor.apply(null, arguments);
    };

    return SchichtplannerFormatterView;
});

